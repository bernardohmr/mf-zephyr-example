"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateEnvironmentManifest = generateEnvironmentManifest;
exports.extractManifestVars = extractManifestVars;
const env_variables_1 = require("../env-variables");
/**
 * Generate a zephyr-manifest.json asset for an environment Merges version-level and
 * environment-level variables
 *
 * @param versionVars - Variables from the version's manifest
 * @param envVars - Environment-specific variables (take priority)
 * @returns Manifest content, hash, and size
 */
async function generateEnvironmentManifest(versionVars, envVars) {
    // Merge variables with environment taking priority
    const mergedVars = Object.assign(Object.assign({}, versionVars), envVars);
    // Generate manifest content
    const content = (0, env_variables_1.generateManifestContent)(mergedVars);
    if (!content) {
        // Return empty manifest if no variables
        const emptyContent = JSON.stringify({ zeVars: {} }, null, 2);
        return {
            content: emptyContent,
            hash: (0, env_variables_1.calculateManifestHash)(emptyContent),
            size: Buffer.byteLength(emptyContent, 'utf8'),
        };
    }
    const hash = (0, env_variables_1.calculateManifestHash)(content);
    const size = Buffer.byteLength(content, 'utf8');
    return {
        content,
        hash,
        size,
    };
}
/**
 * Extract variables from a manifest content string
 *
 * @param manifestContent - JSON content of a zephyr-manifest.json file
 * @returns The zeVars object from the manifest
 */
function extractManifestVars(manifestContent) {
    try {
        const manifest = JSON.parse(manifestContent);
        return manifest.zeVars || {};
    }
    catch (error) {
        console.error('Failed to parse manifest content:', error);
        return {};
    }
}
//# sourceMappingURL=generate-manifest-asset.js.map