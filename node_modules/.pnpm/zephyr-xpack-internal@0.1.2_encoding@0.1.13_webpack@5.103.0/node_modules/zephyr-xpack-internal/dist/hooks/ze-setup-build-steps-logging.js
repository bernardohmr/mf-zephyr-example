"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logBuildSteps = logBuildSteps;
const zephyr_agent_1 = require("zephyr-agent");
function logBuildSteps(pluginOptions, compiler) {
    const { pluginName } = pluginOptions;
    let buildStartedAt = Date.now();
    compiler.hooks.beforeCompile.tapAsync(pluginName, async (params, cb) => {
        buildStartedAt = Date.now();
        zephyr_agent_1.ze_log.init('build started at', buildStartedAt);
        cb();
    });
    compiler.hooks.failed.tap(pluginName, (err) => {
        zephyr_agent_1.ze_log.misc(`build failed in ${Date.now() - buildStartedAt}ms`);
        void pluginOptions.zephyr_engine.logger.then((logger) => {
            logger({
                level: 'error',
                action: 'build:failed',
                message: zephyr_agent_1.ZephyrError.format(err),
            });
        });
    });
    return { buildStartedAt };
}
//# sourceMappingURL=ze-setup-build-steps-logging.js.map