"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isLegacyMFPlugin = isLegacyMFPlugin;
const zephyr_agent_1 = require("zephyr-agent");
const extract_federation_config_1 = require("./extract-federation-config");
function isLegacyMFPlugin(plugin) {
    const options = (0, extract_federation_config_1.extractFederatedConfig)(plugin);
    if (!options) {
        zephyr_agent_1.ze_log.mf('Not a Module Federation plugin');
        return false;
    }
    // If constructor name doesn't match, definitely not webpack's
    if (plugin.constructor.name !== 'ModuleFederationPlugin') {
        zephyr_agent_1.ze_log.mf('Non-legacy Module Federation plugin identified. Current plugin name: ', plugin.constructor.name);
        return false;
    }
    const enhancedFeaturesChecks = [
        // Core enhanced methods (likely present in most versions)
        [plugin, 'getRemoteEntryUrls', 'function'],
        [plugin, 'getContainerEntryModule', 'function'],
        [plugin, 'invalidateRemote', 'function'],
        // Newer enhanced methods (higher version requirements)
        [plugin, 'statsResourceInfo'],
        [plugin, 'getStats', 'function'],
        // Configuration-based detection (version-agnostic)
        [options, 'experiments'],
        [options, 'runtimePlugins'],
        [options, 'enhanced'],
        // Internal properties (likely present across versions)
        [plugin, '_experiments'],
        [plugin, '_enhanced'],
    ];
    for (const check of enhancedFeaturesChecks) {
        if (hasProperty(...check)) {
            zephyr_agent_1.ze_log.mf('Non-legacy Module Federation plugin identified. Plugin contains property: ', check[1]);
            return false; // Has enhanced features, so NOT legacy
        }
    }
    // If we get here, it's webpack's native plugin
    return true;
}
const hasProperty = (target, property, type) => {
    const hasProp = property in target;
    if (!(property in target))
        return false;
    if (type)
        return typeof target[property] === type;
    return hasProp;
};
//# sourceMappingURL=is-legacy-mf-plugin.js.map