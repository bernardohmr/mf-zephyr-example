"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.runtimePluginInsert = runtimePluginInsert;
const zephyr_agent_1 = require("zephyr-agent");
const extract_federation_config_1 = require("./extract-federation-config");
function runtimePluginInsert(plugin) {
    try {
        const runtimePluginPath = require.resolve('./runtime-plugin');
        zephyr_agent_1.ze_log.remotes(`Adding Zephyr runtime plugin: ${runtimePluginPath}`);
        let configRef = (0, extract_federation_config_1.extractFederatedConfig)(plugin);
        if (!configRef) {
            zephyr_agent_1.ze_log.remotes('No MF config found.');
            return false;
        }
        // handle NxModuleFederationPlugin wrapper
        if ('configOverride' in plugin) {
            plugin.configOverride ?? (plugin.configOverride = {});
            configRef = plugin.configOverride;
        }
        // Initialize runtimePlugins array if it doesn't exist
        if (!configRef.runtimePlugins) {
            configRef.runtimePlugins = [];
        }
        // Add the runtime plugin only if it's not already present
        if (!configRef.runtimePlugins.includes(runtimePluginPath)) {
            configRef.runtimePlugins.push(runtimePluginPath);
        }
        zephyr_agent_1.ze_log.remotes(`Runtime plugin added to Module Federation config`);
        return true; // Successfully inserted runtime plugin
    }
    catch (error) {
        zephyr_agent_1.ze_log.remotes(`Failed to resolve runtime plugin path: ${error}`);
        return false; // Failed to insert runtime plugin
    }
}
//# sourceMappingURL=runtime-plugin-insert.js.map